name: Despliegue automÃ¡tico

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted

    steps:
    - name: ğŸ”§ Pull + Build Angular en /home/deploy/my-app
      run: |
        echo "ğŸ“ Entrando al proyecto Angular..."
        cd /home/deploy/my-app

        echo "ğŸŒ Obteniendo Ãºltimos cambios..."
        git fetch
        git reset --hard origin/main  # Asegura que estÃ© limpio
        git pull origin main || { echo "âŒ git pull fallÃ³"; exit 1; }

        echo "ğŸ—ï¸ Ejecutando build con Angular CLI..."
        if ! npx ng build; then
          echo "âŒ Error: FallÃ³ el build"
          exit 1
        fi

        echo "âœ… Build generado exitosamente"

    - name: ğŸ“¤ Copiar archivos de build a /var/www/my-app
      run: |
        echo "ğŸ§¹ Limpiando carpeta destino..."
        rm -rf /var/www/my-app/*

        echo "ğŸ“‚ Copiando archivos desde dist/my-app..."
        cp -r /home/deploy/my-app/dist/my-app/* /var/www/my-app/

        echo "âœ… Despliegue completado con Ã©xito ğŸš€"
