name: Despliegue automÃ¡tico

on:
  push:
    branches:
      - staging
jobs:
  deploy:
    environment: staging
    runs-on: self-hosted

    steps:
    - name: ğŸ”§ Build Angular en /home/deploy/my-app
      run: |
        echo "ğŸ“ Entrando al proyecto Angular..."
        cd /home/deploy/my-app
        git reset --hard
        git fetch
        git pull
        echo "ğŸ“¦ Ejecutando build con Angular CLI..."
        npx ng build
        echo "âœ… Build generado exitosamente"
    - name: ğŸ‘¾ Pruebas unitarias
      run: |
        echo "ğŸ§ Ejecutando pruebas unitarias..."
        if ! npx ng test --watch=false --browsers=ChromeHeadless; then
          echo "âŒ Las pruebas fallaron. Revisa los logs arriba."
          exit 1
        fi
        echo "âœ… Pruebas unitarias completadas"
    - name: ğŸ“¤ Copiar archivos de build a /var/www/my-app
      run: |
        echo "ğŸ“‚ Copiando archivos desde dist/my-app..."
        cp -r /home/deploy/my-app/dist/my-app/* /var/www/my-app/
        echo "âœ… Despliegue completado con Ã©xito ğŸš€"
